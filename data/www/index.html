<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encoder3D Controller</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
</head>
<body>
    <div id="app">
        <div id="sidebar">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h1>Encoder3D</h1>
                <a href="/wifi.html" style="color: #007acc; text-decoration: none; font-size: 0.9em;">⚙️ Setup</a>
            </div>
            <div class="panel">
                <h2>Status <span id="ws-status" style="font-size: 0.6em; color: #f48771;">(Disconnected)</span></h2>
                <div id="status-display">
                    <p>X: <span id="pos-x">0.00</span> mm <small style="color:#999">(set: <span id="set-x">0.00</span> mm, last move: <span id="lastmove-x">0ms</span>)</small></p>
                    <p>Y: <span id="pos-y">0.00</span> mm <small style="color:#999">(set: <span id="set-y">0.00</span> mm, last move: <span id="lastmove-y">0ms</span>)</small></p>
                    <p>Z: <span id="pos-z">0.00</span> mm <small style="color:#999">(set: <span id="set-z">0.00</span> mm, last move: <span id="lastmove-z">0ms</span>)</small></p>
                    <p>E: <span id="pos-e">0.00</span> mm <small style="color:#999">(set: <span id="set-e">0.00</span> mm, last move: <span id="lastmove-e">0ms</span>)</small></p>
                </div>
                <div id="diagnostics" style="margin-top:8px; border-top:1px solid #333; padding-top:8px;">
                    <p>Executor: <strong id="exec-busy">idle</strong> <small id="exec-owner" style="color:#999">(owner: -)</small></p>
                    <p>Halt: <span id="halt-reason" style="color:#f48771">none</span></p>
                    <div style="margin-top:6px;">
                        <div style="font-size:0.9em; color:#aaa; margin-bottom:4px">Messages</div>
                        <div id="msg-log" style="background:#111; border:1px solid #222; padding:8px; height:90px; overflow:auto; font-size:0.9em; color:#ddd; white-space:pre-wrap;"></div>
                    </div>
                </div>
            </div>
            <div class="panel">
                <h2>Thermal</h2>
                <p>Extruder: <span id="temp-ext">0</span>°C / <input type="number" id="target-ext" value="0" style="width: 50px"></p>
                <p>Bed: <span id="temp-bed">0</span>°C / <input type="number" id="target-bed" value="0" style="width: 50px"></p>
                <button onclick="setTemps()">Set Temps</button>
            </div>
            <div class="panel">
                <h2>Configuration</h2>
                <div style="font-size:0.9em; color:#aaa; margin-bottom:6px">Steps / Counts per mm</div>
                <p>X: <input id="cfg-cpm-x" type="number" step="0.0001" style="width:100px"> </p>
                <p>Y: <input id="cfg-cpm-y" type="number" step="0.0001" style="width:100px"> </p>
                <p>Z: <input id="cfg-cpm-z" type="number" step="0.0001" style="width:100px"> </p>
                <p>E: <input id="cfg-cpm-e" type="number" step="0.0001" style="width:100px"> </p>
                <div style="font-size:0.9em; color:#aaa; margin-top:6px">PID Tunings (P I D)</div>
                <p>X: <input id="cfg-pid-x-p" type="number" step="0.0001" style="width:80px"> <input id="cfg-pid-x-i" type="number" step="0.0001" style="width:80px"> <input id="cfg-pid-x-d" type="number" step="0.0001" style="width:80px"></p>
                <p>Y: <input id="cfg-pid-y-p" type="number" step="0.0001" style="width:80px"> <input id="cfg-pid-y-i" type="number" step="0.0001" style="width:80px"> <input id="cfg-pid-y-d" type="number" step="0.0001" style="width:80px"></p>
                <p>Z: <input id="cfg-pid-z-p" type="number" step="0.0001" style="width:80px"> <input id="cfg-pid-z-i" type="number" step="0.0001" style="width:80px"> <input id="cfg-pid-z-d" type="number" step="0.0001" style="width:80px"></p>
                <p>E: <input id="cfg-pid-e-p" type="number" step="0.0001" style="width:80px"> <input id="cfg-pid-e-i" type="number" step="0.0001" style="width:80px"> <input id="cfg-pid-e-d" type="number" step="0.0001" style="width:80px"></p>
                <div style="font-size:0.9em; color:#aaa; margin-top:6px">Max Feedrates (mm/min)</div>
                <p>X: <input id="cfg-maxf-x" type="number" step="1" style="width:80px"> Y: <input id="cfg-maxf-y" id="cfg-maxf-y" type="number" step="1" style="width:80px"></p>
                <p>Z: <input id="cfg-maxf-z" type="number" step="1" style="width:80px"> E: <input id="cfg-maxf-e" type="number" step="1" style="width:80px"></p>
                <div style="margin-top:8px; display:flex; gap:8px;">
                    <button onclick="loadConfig()">Load</button>
                    <button onclick="saveConfig()">Save</button>
                </div>
            </div>
            <div class="panel">
                <h2>Manual Control</h2>
                <button onclick="sendGCode('G28')">Home All</button>
                <div class="jog-controls">
                    <button onclick="sendGCode('G1 X-10')">X-</button>
                    <button onclick="sendGCode('G1 X10')">X+</button>
                    <button onclick="sendGCode('G1 Y-10')">Y-</button>
                    <button onclick="sendGCode('G1 Y10')">Y+</button>
                    <button onclick="sendGCode('G1 Z-10')">Z-</button>
                    <button onclick="sendGCode('G1 Z10')">Z+</button>
                </div>
            </div>
            <div class="panel">
                <h2>Job</h2>
                <input type="file" id="gcode-upload">
                <button onclick="uploadGCode()">Upload & Print</button>
            </div>
        </div>
        <div id="viewer-container">
            <!-- Three.js Canvas will be injected here -->
        </div>
    </div>
    <script src="js/app.js"></script>
</body>
</html>
